function iniciarApp(){consultarApi()}let citaId;async function consultarApi(){try{const e="https://api.cal.com/v1/bookings?userId=1&apiKey=cal_live_734742ae8dbe3eae4139d063a47b8f3d",t=await fetch(e),n=await t.json();filtrar(n.bookings)}catch(e){console.log(e)}}function filtrar(e){const t=document.getElementById("usuarioEmail");if(!t)return void console.log("Elemento div no encontrado");const n=t.textContent.trim();if(!n)return void console.log("Correo electrÃ³nico no encontrado en el div");const a=e.filter(e=>e.attendees[0].email===n),o=new Date;mostrarBookings(a.filter(e=>new Date(e.startTime)>o).filter(e=>"CANCELLED"!==e.status))}function mostrarBookings(e){const t=document.getElementById("bookingTableBody");e.forEach(e=>{const{startTime:n,endTime:a,attendees:o,user:i,id:c}=e,r=document.createElement("tr");r.className="border-b dark:border-gray-700";const d=document.createElement("td");d.className="px-4 py-3 font-medium text-gray-900 whitespace-nowrap dark:text-white",d.textContent=i.name;const l=document.createElement("td");l.className="px-4 py-3 font-medium text-gray-900 whitespace-nowrap dark:text-white",l.textContent=i.email;const s=document.createElement("td");s.className="px-4 py-3 font-medium text-gray-900 whitespace-nowrap dark:text-white",s.textContent=new Date(n).toLocaleString();const m=document.createElement("td");m.className="px-4 py-3 font-medium text-gray-900 whitespace-nowrap dark:text-white",m.textContent=new Date(a).toLocaleString();const p=document.createElement("td"),u=document.createElement("button");u.id="deleteButton",u.className="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900",u.textContent="Cancelar",u.type="button",p.appendChild(u),r.appendChild(d),r.appendChild(l),r.appendChild(s),r.appendChild(m),r.appendChild(p),t.appendChild(r),document.getElementById("deleteButton").addEventListener("click",()=>{cancelarCita(c)})})}async function cancelarCita(e){console.log(e);const t=`https://api.cal.com/v1/bookings/${e}/cancel?apiKey=cal_live_734742ae8dbe3eae4139d063a47b8f3d`;try{const e=await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"}});await e.json()&&Swal.fire({title:"Buen Trabajo!",text:"Cita Cancelada!",icon:"success",button:"Ok"}).then(()=>{setTimeout(()=>{window.location.reload()},1500)})}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al cancelar la cita (verifica si ya actualizaste tu perfil)"})}}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));