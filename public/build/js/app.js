const cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};function iniciarApp(){consultarApi(),nombreCliente(),idCliente(),seleccionarFecha(),seleccionarHora(),mostrarResumen()}async function consultarApi(){try{const e=location.origin+"/public/api/servicios",t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.log(e)}}function mostrarServicios(e){e.forEach(e=>{const{id:t,nombre_servicio:a,descripcion:n}=e,o=document.createElement("a");o.href="#",o.classList.add("max-w-sm","p-8","bg-white","border","border-gray-200","rounded-lg","shadow","hover:border-indigo-300","dark:bg-gray-800","dark:border-gray-700"),o.dataset.idServicio=t,o.onclick=function(){seleccionarServicio(e)};const r=document.createElement("a");r.href="#";const c=document.createElement("h5");c.classList.add("mb-2","text-2xl","font-bold","tracking-tight","text-gray-900","dark:text-white"),c.textContent=a,r.appendChild(c);const i=document.createElement("p");i.classList.add("mb-3","font-normal","text-gray-700","dark:text-gray-400"),i.textContent=n,o.appendChild(r),o.appendChild(i),document.querySelector("#servicios").appendChild(o)})}function seleccionarServicio(e){const{id:t}=e,{servicios:a}=cita,n=document.querySelector(`[data-id-servicio = "${t}"]`);a.some(e=>e.id===t)?(cita.servicios=a.filter(e=>e.id!==t),n.classList.remove("border-indigo-300")):(cita.servicios=[...a,e],n.classList.add("border-indigo-300"))}function mostrarOpcionSeleccionada(){var e=document.getElementById("opciones"),t=document.getElementById("resultado"),a=(document.getElementById("opcionSeleccionada"),document.getElementById("opcionPaciente"));""===e.value?(t.style.display="none",opcionDosHTML.style.display="none"):"paciente"===e.value?a.style.display="block":a.style.display="none"}function nombreCliente(){const e=document.querySelector("#nombre").value;cita.nombre=e}function idCliente(){const e=document.querySelector("#id").value;cita.id=e}function seleccionarFecha(){document.querySelector("#fecha").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[0,6].includes(t)?(e.target.value="",mostrarAlerta("Fines de semana no permitidos","error","#alertas")):cita.fecha=e.target.value}))}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",(function(e){const t=e.target.value.split(":")[0];t<7||t>18?(e.target.value="",mostrarAlerta("hora no valida","error","#alertas")):(cita.hora=e.target.value,console.log(cita))}))}function mostrarAlerta(e,t,a,n=!0){const o=document.querySelector("#alertaError");o&&o.remove(),"error"==t?alertaClase="flex items-center p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400":"bien"==t&&(alertaClase="flex items-center p-4 mb-4 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400");var r=document.createElement("div");r.className=alertaClase,r.setAttribute("role","alert");var c=document.createElement("span");c.className="font-medium";e=document.createTextNode(e);r.appendChild(c),r.appendChild(e),r.id="alertaError";document.querySelector(a).appendChild(r),n&&setTimeout(()=>{r.remove()},3e3)}function mostrarResumen(){const e=document.querySelector("#resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(cita).includes("")||0===cita.servicios.length)return void mostrarAlerta("Faltan datos de servicios, fecha u hora","error","#resumen",!1);const{nombre:t,fecha:a,hora:n,servicios:o}=cita,r=document.createElement("div");r.className="flex flex-col pb-3";const c=document.createElement("dt");c.className="mb-1 text-gray-500 md:text-base dark:text-gray-400",c.textContent="servicios: ",r.appendChild(c),o.forEach(e=>{const{nombre_servicio:t}=e,a=document.createElement("dd");a.className="text-base font-semibold",a.textContent=t,r.appendChild(a)});const i=document.createElement("dl");i.className="max-w-md text-gray-900 divide-y divide-gray-200 dark:text-white dark:divide-gray-700";const d=document.createElement("div");d.className="flex flex-col pb-3";const s=document.createElement("dt");s.className="mb-1 text-gray-500 md:text-base dark:text-gray-400",s.textContent="Nombre: ";const l=document.createElement("dd");l.className="text-base font-semibold",l.textContent=t,d.appendChild(s),d.appendChild(l);const m=document.createElement("div");m.className="flex flex-col pb-3";const u=document.createElement("dt");u.className="mb-1 text-gray-500 md:text-base dark:text-gray-400",u.textContent="Fecha: ";const p=new Date(a),b=p.getMonth(),g=p.getDate()+2,h=p.getFullYear(),f=new Date(Date.UTC(h,b,g)).toLocaleDateString("es-CO",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),x=document.createElement("dd");x.className="text-base font-semibold",x.textContent=f,m.appendChild(u),m.appendChild(x);const v=document.createElement("div");v.className="flex flex-col pb-3";const y=document.createElement("dt");y.className="mb-1 text-gray-500 md:text-base dark:text-gray-400",y.textContent="Hora: ";const C=document.createElement("dd");C.className="text-base font-semibold",C.textContent=n.split(":")[0]+":00",v.appendChild(y),v.appendChild(C),i.appendChild(d),i.appendChild(m),i.appendChild(v),i.appendChild(r);const E=document.createElement("button");E.className="text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2",E.textContent="Reservar Cita",E.onclick=reservarCita,e.appendChild(i),e.appendChild(E)}async function reservarCita(){const{id:e,nombre:t,fecha:a,hora:n,servicios:o}=cita,r=o.map(e=>e.id),c=new FormData;c.append("id_paciente",e),c.append("fecha",a),c.append("hora",n.split(":")[0]+":00:00"),c.append("servicios",r),console.log(...c);try{const e=location.origin+"/public/api/cita",t=await fetch(e,{method:"POST",body:c});(await t.json()).resultado&&Swal.fire({title:"Buen Trabajo!",text:"Cita Creada!",icon:"success",button:"Ok"}).then(()=>{setTimeout(()=>{window.location.reload()},15)})}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al guardar la cita(verifica si ya actualizaste tu perfil)"})}}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));